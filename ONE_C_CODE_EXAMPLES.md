# Полная инструкция по интеграции с Django сайтом

---

## Содержание

1. [Настройка параметров](#настройка-параметров)
2. [Базовые функции](#базовые-функции)
3. [Отправка товаров через API](#отправка-товаров-через-api)
4. [Отправка файла](#отправка-файла)
5. [Обработка ответа](#обработка-ответа)
6. [Примеры использования](#примеры-использования)
7. [Обработка ошибок](#обработка-ошибок)

---

## Настройка параметров

### Константы для настройки

Создайте константы в конфигурации 1С или используйте переменные:

```1c
// Параметры подключения
Перем URLСайта;
Перем ТокенАвторизации;
Перем ТаймаутСекунд;

// Инициализация параметров
Процедура ИнициализацияПараметров()
    URLСайта = "https://your-site.com";  // Замените на ваш домен
    ТокенАвторизации = "ваш-секретный-токен";  // Тот же токен, что в settings.py
    ТаймаутСекунд = 30;  // Таймаут подключения в секундах
КонецПроцедуры
```

---

## Базовые функции

### Функция: Создание HTTP соединения

```1c
// Создает и настраивает HTTP соединение с сайтом
Функция СоздатьHTTPСоединение() Экспорт
    
    Попытка
        // Для HTTPS используем защищенное соединение
        Соединение = Новый HTTPСоединение(
            URLСайта,
            443,  // Порт для HTTPS (для HTTP используйте 80)
            ,     // Прокси (если не нужен)
            ,     // Пользователь прокси
            ,     // Пароль прокси
            ТаймаутСекунд,
            Новый ЗащищенноеСоединениеOpenSSL()  // Для HTTPS
        );
        
        Возврат Соединение;
        
    Исключение
        Сообщить("Ошибка создания HTTP соединения: " + ОписаниеОшибки());
        Возврат Неопределено;
    КонецПопытки;
    
КонецФункции
```

### Функция: Формирование заголовков запроса

```1c
// Формирует заголовки для HTTP запроса
Функция СформироватьЗаголовки() Экспорт
    
    Заголовки = Новый Соответствие;
    
    // Токен авторизации в заголовке
    Заголовки["X-API-Key"] = ТокенАвторизации;
    
    // Content-Type для JSON
    Заголовки["Content-Type"] = "application/json; charset=utf-8";
    
    Возврат Заголовки;
    
КонецФункции
```

---

## Отправка товаров через API

### Функция: Преобразование товара в JSON

```1c
// Преобразует данные товара из 1С в формат JSON для отправки
Функция ТоварВJSON(Товар) Экспорт
    
    ТоварJSON = Новый Структура;
    
    // Обязательные поля
    ТоварJSON.Вставить("sku", Строка(Товар.Артикул));
    ТоварJSON.Вставить("name", Товар.Наименование);
    ТоварJSON.Вставить("price", Товар.Цена);
    
    // Опциональные поля
    Если Товар.Свойство("Описание") И Товар.Описание <> "" Тогда
        ТоварJSON.Вставить("description", Товар.Описание);
    КонецЕсли;
    
    Если Товар.Свойство("СтараяЦена") И Товар.СтараяЦена > 0 Тогда
        ТоварJSON.Вставить("old_price", Товар.СтараяЦена);
    КонецЕсли;
    
    Если Товар.Свойство("Остаток") Тогда
        ТоварJSON.Вставить("stock", Товар.Остаток);
    КонецЕсли;
    
    Если Товар.Свойство("Категория") И Товар.Категория <> "" Тогда
        ТоварJSON.Вставить("category", Строка(Товар.Категория));
    КонецЕсли;
    
    Если Товар.Свойство("Активен") Тогда
        ТоварJSON.Вставить("is_active", Товар.Активен);
    КонецЕсли;
    
    // Характеристики товара
    Если Товар.Свойство("Характеристики") И Товар.Характеристики.Количество() > 0 Тогда
        МассивХарактеристик = Новый Массив;
        
        Для Каждого Характеристика Из Товар.Характеристики Цикл
            ХарактеристикаJSON = Новый Структура;
            ХарактеристикаJSON.Вставить("name", Характеристика.Название);
            ХарактеристикаJSON.Вставить("value", Характеристика.Значение);
            МассивХарактеристик.Добавить(ХарактеристикаJSON);
        КонецЦикла;
        
        ТоварJSON.Вставить("characteristics", МассивХарактеристик);
    КонецЕсли;
    
    Возврат ТоварJSON;
    
КонецФункции
```

### Функция: Формирование JSON запроса

```1c
// Формирует полный JSON запрос для отправки товаров
Функция СформироватьJSONЗапрос(МассивТоваров) Экспорт
    
    СтруктураЗапроса = Новый Структура;
    
    // Токен авторизации
    СтруктураЗапроса.Вставить("token", ТокенАвторизации);
    
    // Массив товаров
    МассивТоваровJSON = Новый Массив;
    
    Для Каждого Товар Из МассивТоваров Цикл
        ТоварJSON = ТоварВJSON(Товар);
        МассивТоваровJSON.Добавить(ТоварJSON);
    КонецЦикла;
    
    СтруктураЗапроса.Вставить("products", МассивТоваровJSON);
    
    // Преобразуем в JSON строку
    ЗаписьJSON = Новый ЗаписьJSON;
    ЗаписьJSON.УстановитьСтроку();
    ЗаписатьJSON(ЗаписьJSON, СтруктураЗапроса);
    СтрокаJSON = ЗаписьJSON.Закрыть();
    
    Возврат СтрокаJSON;
    
КонецФункции
```

### Процедура: Отправка товаров на сайт

```1c
// Отправляет товары на сайт через API
Процедура ОтправитьТоварыНаСайт(МассивТоваров) Экспорт
    
    Если МассивТоваров.Количество() = 0 Тогда
        Сообщить("Массив товаров пуст!");
        Возврат;
    КонецЕсли;
    
    // Инициализация параметров (если еще не инициализированы)
    Если ПустаяСтрока(URLСайта) Тогда
        ИнициализацияПараметров();
    КонецЕсли;
    
    // Формируем JSON запрос
    СтрокаJSON = СформироватьJSONЗапрос(МассивТоваров);
    
    // Создаем HTTP соединение
    Соединение = СоздатьHTTPСоединение();
    Если Соединение = Неопределено Тогда
        Возврат;
    КонецЕсли;
    
    // Формируем заголовки
    Заголовки = СформироватьЗаголовки();
    
    // Отправляем запрос
    Попытка
        Ответ = Соединение.ОтправитьДляОбработки("POST", "/api/1c/sync/", Заголовки, СтрокаJSON);
        
        // Обрабатываем ответ
        ОбработатьОтветAPI(Ответ);
        
    Исключение
        Сообщить("Ошибка при отправке товаров: " + ОписаниеОшибки());
    КонецПопытки;
    
КонецПроцедуры
```

---

## Обработка ответа

### Процедура: Обработка ответа от API

```1c
// Обрабатывает ответ от сервера
Процедура ОбработатьОтветAPI(Ответ) Экспорт
    
    КодОтвета = Ответ.КодСостояния;
    
    Если КодОтвета = 200 Или КодОтвета = 207 Тогда
        
        // Успешный ответ
        Попытка
            ТелоОтвета = Ответ.ПолучитьТелоКакСтроку();
            
            // Парсим JSON ответ
            ЧтениеJSON = Новый ЧтениеJSON;
            ЧтениеJSON.УстановитьСтроку(Телоответа);
            Результат = ПрочитатьJSON(ЧтениеJSON);
            ЧтениеJSON.Закрыть();
            
            // Выводим информацию о результате
            Сообщить("Статус: " + Результат.status);
            Сообщить("Обработано товаров: " + Результат.processed);
            Сообщить("Создано товаров: " + Результат.created);
            Сообщить("Обновлено товаров: " + Результат.updated);
            
            // Проверяем ошибки
            Если Результат.Свойство("errors") И Результат.errors.Количество() > 0 Тогда
                Сообщить("Количество ошибок: " + Результат.errors.Количество());
                
                Для Каждого Ошибка Из Результат.errors Цикл
                    Сообщить("Ошибка: " + Ошибка);
                КонецЦикла;
            КонецЕсли;
            
        Исключение
            Сообщить("Ошибка парсинга ответа: " + ОписаниеОшибки());
        КонецПопытки;
        
    ИначеЕсли КодОтвета = 401 Тогда
        Сообщить("Ошибка авторизации! Проверьте токен.");
        Сообщить("Ответ сервера: " + Ответ.ПолучитьТелоКакСтроку());
        
    ИначеЕсли КодОтвета = 400 Тогда
        Сообщить("Ошибка валидации данных!");
        Сообщить("Ответ сервера: " + Ответ.ПолучитьТелоКакСтроку());
        
    Иначе
        Сообщить("Ошибка! Код ответа: " + КодОтвета);
        Сообщить("Ответ сервера: " + Ответ.ПолучитьТелоКакСтроку());
    КонецЕсли;
    
КонецПроцедуры
```

---

## Отправка файла

### Процедура: Отправка файла на сайт

```1c
// Отправляет файл (CSV, XML или JSON) на сайт
Процедура ОтправитьФайлНаСайт(ПутьКФайлу) Экспорт
    
    Если НЕ Файл.Существует(ПутьКФайлу) Тогда
        Сообщить("Файл не найден: " + ПутьКФайлу);
        Возврат;
    КонецЕсли;
    
    // Инициализация параметров
    Если ПустаяСтрока(URLСайта) Тогда
        ИнициализацияПараметров();
    КонецЕсли;
    
    // Читаем файл
    Попытка
        ДвоичныеДанные = ПолучитьИзВременногоХранилища(ПутьКФайлу);
    Исключение
        Сообщить("Ошибка чтения файла: " + ОписаниеОшибки());
        Возврат;
    КонецПопытки;
    
    // Создаем HTTP соединение
    Соединение = СоздатьHTTPСоединение();
    Если Соединение = Неопределено Тогда
        Возврат;
    КонецЕсли;
    
    // Формируем заголовки (без Content-Type для multipart/form-data)
    Заголовки = Новый Соответствие;
    Заголовки["X-API-Key"] = ТокенАвторизации;
    
    // Отправляем файл
    Попытка
        Ответ = Соединение.ОтправитьДляОбработки("POST", "/api/1c/upload/", Заголовки, ДвоичныеДанные);
        
        // Обрабатываем ответ
        ОбработатьОтветAPI(Ответ);
        
    Исключение
        Сообщить("Ошибка при отправке файла: " + ОписаниеОшибки());
    КонецПопытки;
    
КонецПроцедуры
```

---

## Примеры использования

### Пример 1: Отправка одного товара

```1c
// Создаем структуру товара
Товар = Новый Структура;
Товар.Вставить("Артикул", "ART001");
Товар.Вставить("Наименование", "Товар 1");
Товар.Вставить("Цена", 1000.00);
Товар.Вставить("Остаток", 10);
Товар.Вставить("Категория", "Категория 1");
Товар.Вставить("Активен", Истина);

// Массив товаров
МассивТоваров = Новый Массив;
МассивТоваров.Добавить(Товар);

// Отправляем
ОтправитьТоварыНаСайт(МассивТоваров);
```

### Пример 2: Отправка товаров из справочника

```1c
// Получаем товары из справочника "Номенклатура"
Процедура ОтправитьТоварыИзСправочника()
    
    Запрос = Новый Запрос;
    Запрос.Текст = "
    |ВЫБРАТЬ
    |    Номенклатура.Ссылка КАК Товар,
    |    Номенклатура.Артикул КАК Артикул,
    |    Номенклатура.Наименование КАК Наименование,
    |    Номенклатура.Описание КАК Описание,
    |    Номенклатура.Цена КАК Цена,
    |    Номенклатура.СтараяЦена КАК СтараяЦена,
    |    Номенклатура.Остаток КАК Остаток,
    |    Номенклатура.Категория.Наименование КАК Категория
    |ИЗ
    |    Справочник.Номенклатура КАК Номенклатура
    |ГДЕ
    |    НЕ Номенклатура.ПометкаУдаления
    |    И Номенклатура.Активен";
    
    РезультатЗапроса = Запрос.Выполнить();
    Выборка = РезультатЗапроса.Выбрать();
    
    МассивТоваров = Новый Массив;
    
    Пока Выборка.Следующий() Цикл
        
        Товар = Новый Структура;
        Товар.Вставить("Артикул", Строка(Выборка.Артикул));
        Товар.Вставить("Наименование", Выборка.Наименование);
        Товар.Вставить("Описание", Строка(Выборка.Описание));
        Товар.Вставить("Цена", Выборка.Цена);
        Товар.Вставить("СтараяЦена", Выборка.СтараяЦена);
        Товар.Вставить("Остаток", Выборка.Остаток);
        Товар.Вставить("Категория", Строка(Выборка.Категория));
        Товар.Вставить("Активен", Истина);
        Товар.Вставить("Характеристики", Новый Массив);  // Можно добавить характеристики
        
        МассивТоваров.Добавить(Товар);
        
    КонецЦикла;
    
    // Отправляем товары (разбиваем на части по 100 штук)
    КоличествоТоваров = МассивТоваров.Количество();
    РазмерПакета = 100;
    
    Для Индекс = 0 По КоличествоТоваров - 1 Шаг РазмерПакета Цикл
        
        КонечныйИндекс = Мин(Индекс + РазмерПакета - 1, КоличествоТоваров - 1);
        
        ПакетТоваров = Новый Массив;
        Для ИндексПакета = Индекс По КонечныйИндекс Цикл
            ПакетТоваров.Добавить(МассивТоваров[ИндексПакета]);
        КонецЦикла;
        
        Сообщить("Отправка пакета товаров: " + (Индекс + 1) + " - " + (КонечныйИндекс + 1) + " из " + КоличествоТоваров);
        ОтправитьТоварыНаСайт(ПакетТоваров);
        
        // Небольшая пауза между пакетами
        Пауза(1000);  // 1 секунда
        
    КонецЦикла;
    
    Сообщить("Отправка завершена!");
    
КонецПроцедуры
```

### Пример 3: Отправка товаров с характеристиками

```1c
// Создаем товар с характеристиками
Товар = Новый Структура;
Товар.Вставить("Артикул", "ART001");
Товар.Вставить("Наименование", "Товар 1");
Товар.Вставить("Цена", 1000.00);
Товар.Вставить("Остаток", 10);

// Характеристики
МассивХарактеристик = Новый Массив;

Характеристика1 = Новый Структура;
Характеристика1.Вставить("Название", "Цвет");
Характеристика1.Вставить("Значение", "Красный");
МассивХарактеристик.Добавить(Характеристика1);

Характеристика2 = Новый Структура;
Характеристика2.Вставить("Название", "Материал");
Характеристика2.Вставить("Значение", "Металл");
МассивХарактеристик.Добавить(Характеристика2);

Товар.Вставить("Характеристики", МассивХарактеристик);

// Отправляем
МассивТоваров = Новый Массив;
МассивТоваров.Добавить(Товар);
ОтправитьТоварыНаСайт(МассивТоваров);
```

### Пример 4: Отправка только измененных товаров

```1c
// Отправляет только товары, измененные после указанной даты
Процедура ОтправитьИзмененныеТовары(ДатаИзменения)
    
    Запрос = Новый Запрос;
    Запрос.Текст = "
    |ВЫБРАТЬ
    |    Номенклатура.Ссылка КАК Товар,
    |    Номенклатура.Артикул КАК Артикул,
    |    Номенклатура.Наименование КАК Наименование,
    |    Номенклатура.Цена КАК Цена,
    |    Номенклатура.Остаток КАК Остаток
    |ИЗ
    |    Справочник.Номенклатура КАК Номенклатура
    |ГДЕ
    |    НЕ Номенклатура.ПометкаУдаления
    |    И Номенклатура.Активен
    |    И Номенклатура.ДатаИзменения >= &ДатаИзменения";
    
    Запрос.УстановитьПараметр("ДатаИзменения", ДатаИзменения);
    
    РезультатЗапроса = Запрос.Выполнить();
    Выборка = РезультатЗапроса.Выбрать();
    
    МассивТоваров = Новый Массив;
    
    Пока Выборка.Следующий() Цикл
        Товар = Новый Структура;
        Товар.Вставить("Артикул", Строка(Выборка.Артикул));
        Товар.Вставить("Наименование", Выборка.Наименование);
        Товар.Вставить("Цена", Выборка.Цена);
        Товар.Вставить("Остаток", Выборка.Остаток);
        Товар.Вставить("Активен", Истина);
        
        МассивТоваров.Добавить(Товар);
    КонецЦикла;
    
    Если МассивТоваров.Количество() > 0 Тогда
        Сообщить("Найдено измененных товаров: " + МассивТоваров.Количество());
        ОтправитьТоварыНаСайт(МассивТоваров);
    Иначе
        Сообщить("Нет измененных товаров для отправки");
    КонецЕсли;
    
КонецПроцедуры
```

---

## Обработка ошибок

### Улучшенная обработка ошибок

```1c
// Расширенная обработка ответа с логированием
Процедура ОбработатьОтветAPIРасширенная(Ответ, НомерПопытки = 1) Экспорт
    
    КодОтвета = Ответ.КодСостояния;
    ТелоОтвета = Ответ.ПолучитьТелоКакСтроку();
    
    // Логируем ответ
    ЗаписьЛога = Новый ЗаписьТекста;
    ЗаписьЛога.Открыть("C:\Logs\1C_Sync_" + Формат(ТекущаяДата(), "ДФ=yyyyMMdd") + ".txt", ДляДополнения);
    ЗаписьЛога.ЗаписатьСтроку(Символы.ПС + "=== " + ТекущаяДата() + " " + ТекущееВремя() + " ===");
    ЗаписьЛога.ЗаписатьСтроку("Код ответа: " + КодОтвета);
    ЗаписьЛога.ЗаписатьСтроку("Тело ответа: " + ТелоОтвета);
    ЗаписьЛога.Закрыть();
    
    Если КодОтвета = 200 Тогда
        // Успешно
        Попытка
            ЧтениеJSON = Новый ЧтениеJSON;
            ЧтениеJSON.УстановитьСтроку(Телоответа);
            Результат = ПрочитатьJSON(ЧтениеJSON);
            ЧтениеJSON.Закрыть();
            
            Сообщить("✓ Успешно! Обработано: " + Результат.processed + 
                     ", Создано: " + Результат.created + 
                     ", Обновлено: " + Результат.updated);
            
        Исключение
            Сообщить("Ошибка парсинга ответа: " + ОписаниеОшибки());
        КонецПопытки;
        
    ИначеЕсли КодОтвета = 207 Тогда
        // Частичный успех
        Попытка
            ЧтениеJSON = Новый ЧтениеJSON;
            ЧтениеJSON.УстановитьСтроку(Телоответа);
            Результат = ПрочитатьJSON(ЧтениеJSON);
            ЧтениеJSON.Закрыть();
            
            Сообщить("⚠ Частичный успех! Обработано: " + Результат.processed);
            
            Если Результат.Свойство("errors") И Результат.errors.Количество() > 0 Тогда
                Сообщить("Ошибки:");
                Для Каждого Ошибка Из Результат.errors Цикл
                    Сообщить("  - " + Ошибка);
                КонецЦикла;
            КонецЕсли;
            
        Исключение
            Сообщить("Ошибка парсинга ответа: " + ОписаниеОшибки());
        КонецПопытки;
        
    ИначеЕсли КодОтвета = 401 Тогда
        Сообщить("✗ Ошибка авторизации! Проверьте токен в настройках.");
        
    ИначеЕсли КодОтвета = 400 Тогда
        Сообщить("✗ Ошибка валидации данных!");
        Сообщить("Ответ: " + ТелоОтвета);
        
    ИначеЕсли КодОтвета = 500 Тогда
        Сообщить("✗ Ошибка сервера! Попробуйте позже.");
        Сообщить("Ответ: " + ТелоОтвета);
        
    Иначе
        Сообщить("✗ Неизвестная ошибка! Код: " + КодОтвета);
        Сообщить("Ответ: " + ТелоОтвета);
    КонецЕсли;
    
КонецПроцедуры
```

### Повторная отправка при ошибке

```1c
// Отправка с повторными попытками при ошибке
Процедура ОтправитьТоварыСПовторами(МассивТоваров, КоличествоПопыток = 3) Экспорт
    
    Для Попытка = 1 По КоличествоПопыток Цикл
        
        Если Попытка > 1 Тогда
            Сообщить("Повторная попытка " + Попытка + " из " + КоличествоПопыток);
            Пауза(5000);  // Пауза 5 секунд перед повтором
        КонецЕсли;
        
        Попытка
            СтрокаJSON = СформироватьJSONЗапрос(МассивТоваров);
            Соединение = СоздатьHTTPСоединение();
            
            Если Соединение = Неопределено Тогда
                Продолжить;
            КонецЕсли;
            
            Заголовки = СформироватьЗаголовки();
            Ответ = Соединение.ОтправитьДляОбработки("POST", "/api/1c/sync/", Заголовки, СтрокаJSON);
            
            // Если успешно - выходим
            Если Ответ.КодСостояния = 200 Или Ответ.КодСостояния = 207 Тогда
                ОбработатьОтветAPIРасширенная(Ответ, Попытка);
                Возврат;
            КонецЕсли;
            
            // Если ошибка авторизации - не повторяем
            Если Ответ.КодСостояния = 401 Тогда
                ОбработатьОтветAPIРасширенная(Ответ, Попытка);
                Возврат;
            КонецЕсли;
            
            // Для других ошибок - повторяем
            ОбработатьОтветAPIРасширенная(Ответ, Попытка);
            
        Исключение
            Сообщить("Ошибка при попытке " + Попытка + ": " + ОписаниеОшибки());
        КонецПопытки;
        
    КонецЦикла;
    
    Сообщить("✗ Не удалось отправить товары после " + КоличествоПопыток + " попыток");
    
КонецПроцедуры
```

---

## Полный пример обработки

### Пример: Полная обработка с выборкой из справочника

```1c
// Полный пример обработки товаров из справочника
Процедура СинхронизироватьТоварыССайтом()
    
    // Инициализация
    ИнициализацияПараметров();
    
    // Получаем товары
    Запрос = Новый Запрос;
    Запрос.Текст = "
    |ВЫБРАТЬ
    |    Номенклатура.Ссылка КАК Ссылка,
    |    Номенклатура.Артикул КАК Артикул,
    |    Номенклатура.Наименование КАК Наименование,
    |    Номенклатура.Описание КАК Описание,
    |    Номенклатура.Цена КАК Цена,
    |    Номенклатура.СтараяЦена КАК СтараяЦена,
    |    Номенклатура.Остаток КАК Остаток,
    |    Номенклатура.Категория.Наименование КАК Категория,
    |    Номенклатура.Активен КАК Активен
    |ИЗ
    |    Справочник.Номенклатура КАК Номенклатура
    |ГДЕ
    |    НЕ Номенклатура.ПометкаУдаления
    |    И Номенклатура.Активен
    |
    |УПОРЯДОЧИТЬ ПО
    |    Номенклатура.Наименование";
    
    РезультатЗапроса = Запрос.Выполнить();
    Выборка = РезультатЗапроса.Выбрать();
    
    МассивТоваров = Новый Массив;
    Счетчик = 0;
    
    Пока Выборка.Следующий() Цикл
        
        Товар = Новый Структура;
        Товар.Вставить("Артикул", Строка(Выборка.Артикул));
        Товар.Вставить("Наименование", Выборка.Наименование);
        
        Если НЕ ПустаяСтрока(Выборка.Описание) Тогда
            Товар.Вставить("Описание", Выборка.Описание);
        КонецЕсли;
        
        Товар.Вставить("Цена", Выборка.Цена);
        
        Если Выборка.СтараяЦена > 0 Тогда
            Товар.Вставить("СтараяЦена", Выборка.СтараяЦена);
        КонецЕсли;
        
        Товар.Вставить("Остаток", Выборка.Остаток);
        
        Если НЕ ПустаяСтрока(Выборка.Категория) Тогда
            Товар.Вставить("Категория", Выборка.Категория);
        КонецЕсли;
        
        Товар.Вставить("Активен", Выборка.Активен);
        Товар.Вставить("Характеристики", Новый Массив);
        
        МассивТоваров.Добавить(Товар);
        Счетчик = Счетчик + 1;
        
        // Отправляем пакетами по 100 товаров
        Если МассивТоваров.Количество() >= 100 Тогда
            Сообщить("Отправка пакета товаров: " + Счетчик + " товаров");
            ОтправитьТоварыСПовторами(МассивТоваров, 3);
            МассивТоваров.Очистить();
            Пауза(1000);  // Пауза между пакетами
        КонецЕсли;
        
    КонецЦикла;
    
    // Отправляем оставшиеся товары
    Если МассивТоваров.Количество() > 0 Тогда
        Сообщить("Отправка последнего пакета: " + МассивТоваров.Количество() + " товаров");
        ОтправитьТоварыСПовторами(МассивТоваров, 3);
    КонецЕсли;
    
    Сообщить("Синхронизация завершена! Всего обработано: " + Счетчик + " товаров");
    
КонецПроцедуры
```

---

## Настройка регламентного задания

### Создание регламентного задания для автоматической синхронизации

```1c
// Процедура для регламентного задания
Процедура РегламентноеЗадание_СинхронизацияТоваров() Экспорт
    
    // Инициализация
    ИнициализацияПараметров();
    
    // Получаем товары, измененные за последние 24 часа
    ДатаС = ТекущаяДата() - 1;  // Вчера
    
    Запрос = Новый Запрос;
    Запрос.Текст = "
    |ВЫБРАТЬ
    |    Номенклатура.Артикул КАК Артикул,
    |    Номенклатура.Наименование КАК Наименование,
    |    Номенклатура.Цена КАК Цена,
    |    Номенклатура.Остаток КАК Остаток
    |ИЗ
    |    Справочник.Номенклатура КАК Номенклатура
    |ГДЕ
    |    НЕ Номенклатура.ПометкаУдаления
    |    И Номенклатура.Активен
    |    И Номенклатура.ДатаИзменения >= &ДатаС";
    
    Запрос.УстановитьПараметр("ДатаС", ДатаС);
    
    РезультатЗапроса = Запрос.Выполнить();
    Выборка = РезультатЗапроса.Выбрать();
    
    МассивТоваров = Новый Массив;
    
    Пока Выборка.Следующий() Цикл
        Товар = Новый Структура;
        Товар.Вставить("Артикул", Строка(Выборка.Артикул));
        Товар.Вставить("Наименование", Выборка.Наименование);
        Товар.Вставить("Цена", Выборка.Цена);
        Товар.Вставить("Остаток", Выборка.Остаток);
        Товар.Вставить("Активен", Истина);
        
        МассивТоваров.Добавить(Товар);
    КонецЦикла;
    
    Если МассивТоваров.Количество() > 0 Тогда
        Сообщить("Найдено измененных товаров: " + МассивТоваров.Количество());
        ОтправитьТоварыСПовторами(МассивТоваров, 3);
    Иначе
        Сообщить("Нет измененных товаров для синхронизации");
    КонецЕсли;
    
КонецПроцедуры
```

**Настройка регламентного задания в 1С:**
1. Администрирование → Регламентные задания
2. Создать новое задание
3. Метод: `РегламентноеЗадание_СинхронизацияТоваров`
4. Расписание: ежедневно в определенное время (например, в 2:00 ночи)

---

## Важные замечания

### Безопасность

1. **Храните токен в безопасности:**
   - Не храните токен в открытом виде в коде
   - Используйте константы или хранилище настроек
   - Ограничьте доступ к настройкам

2. **Используйте HTTPS:**
   - В продакшене всегда используйте HTTPS (порт 443)
   - Для тестирования можно использовать HTTP (порт 80)

### Производительность

1. **Разбивайте на пакеты:**
   - Отправляйте не более 100-200 товаров за раз
   - Делайте паузы между пакетами (1-2 секунды)

2. **Используйте индексы:**
   - Убедитесь, что запросы к справочнику используют индексы
   - Оптимизируйте запросы для больших объемов данных

### Обработка ошибок

1. **Логируйте все операции:**
   - Сохраняйте ответы сервера
   - Логируйте ошибки для анализа

2. **Повторные попытки:**
   - Используйте повторные попытки для временных ошибок
   - Не повторяйте при ошибках авторизации (401)

---

## Готовый модуль для копирования

Создайте внешнюю обработку или модуль в 1С и скопируйте все функции выше. Затем используйте:

```1c
// Пример использования
ИнициализацияПараметров();

// Отправка товаров
СинхронизироватьТоварыССайтом();

// Или отправка файла
ОтправитьФайлНаСайт("C:\Export\products.csv");
```