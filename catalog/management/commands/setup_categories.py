from django.core.management.base import BaseCommand
from catalog.models import Category


# 4 основные категории и ключевые слова для автораспределения товаров
MAIN_CATEGORIES = {
    'Автоэлектрика': {
        'keywords': [
            'стартер', 'генератор', 'датчик', 'реле', 'проводка', 'блок управления',
            'катушка зажигания', 'свеча', 'аккумулятор', 'предохранитель', 'лампа',
            'фара', 'фонарь', 'сигнал', 'электро', 'sensor', 'starter', 'generator',
            'alternator', 'coil', 'ignition', 'высоковольтн', 'провод',
        ],
        'order': 1,
    },
    'Двигатель и выхлопная система': {
        'keywords': [
            'двигатель', 'мотор', 'поршень', 'кольца поршневые', 'коленвал', 'распредвал',
            'клапан', 'прокладка гбц', 'гбц', 'блок цилиндров', 'турбина', 'турбокомпрессор',
            'форсунка', 'тнвд', 'насос топливный', 'фильтр', 'масляный насос', 'помпа',
            'водяной насос', 'термостат', 'радиатор', 'вентилятор', 'вискомуфта',
            'ремень грм', 'цепь грм', 'натяжитель', 'ролик', 'выхлоп', 'глушитель',
            'катализатор', 'коллектор', 'engine', 'piston', 'valve', 'turbo', 'injector',
            'вкладыш', 'шатун', 'маслосъемн', 'сальник', 'маслоохладитель',
            'интеркулер', 'egr', 'дроссель', 'впуск', 'плунжер', 'трубк', 'обратк',
            'топливн', 'ремкомплект грм', 'ремкомплект двигателя',
        ],
        'order': 2,
    },
    'Детали подвески': {
        'keywords': [
            'амортизатор', 'пружина', 'рычаг', 'сайлентблок', 'шаровая', 'опора',
            'стойка', 'втулка стабилизатора', 'стабилизатор', 'подшипник ступицы',
            'ступица', 'кулак', 'цапфа', 'тяга', 'наконечник', 'пыльник', 'отбойник',
            'suspension', 'shock', 'spring', 'arm', 'bushing', 'bearing', 'hub',
            'подвеск', 'стойк',
        ],
        'order': 3,
    },
    'Трансмиссия и тормозная система': {
        'keywords': [
            'кпп', 'коробка передач', 'акпп', 'мкпп', 'сцепление', 'корзина сцепления',
            'диск сцепления', 'выжимной', 'маховик', 'редуктор', 'дифференциал',
            'полуось', 'шрус', 'кардан', 'крестовина', 'раздатка', 'раздаточная',
            'тормоз', 'колодки', 'диск тормозной', 'суппорт', 'цилиндр тормозной',
            'шланг тормозной', 'abs', 'transmission', 'clutch', 'brake', 'gearbox',
            'трансмисс', 'привод',
        ],
        'order': 4,
    },
}


class Command(BaseCommand):
    help = 'Создает 4 основные категории (удаляет все существующие)'

    def add_arguments(self, parser):
        parser.add_argument(
            '--keep-subcategories',
            action='store_true',
            help='Сохранить подкатегории (переместить под новые родители)',
        )

    def handle(self, *args, **options):
        self.stdout.write('Удаление всех категорий...')
        Category.objects.all().delete()
        self.stdout.write(self.style.SUCCESS('Все категории удалены.'))
        
        self.stdout.write('Создание 4 основных категорий...')
        
        for name, data in MAIN_CATEGORIES.items():
            category = Category.objects.create(
                name=name,
                is_active=True,
                order=data['order'],
            )
            self.stdout.write(self.style.SUCCESS(f'  ✓ {name}'))
        
        self.stdout.write(self.style.SUCCESS('\nГотово! Созданы 4 основные категории.'))
        self.stdout.write('Теперь можно импортировать товары - они автоматически распределятся по категориям.')
