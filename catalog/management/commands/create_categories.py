"""
Management команда для создания категорий из файла info3.md
"""
from django.core.management.base import BaseCommand
from catalog.models import Category


class Command(BaseCommand):
    help = 'Создает основные категории товаров из структуры info3.md'

    def handle(self, *args, **options):
        # Структура категорий из info3.md
        categories_structure = {
            'Автоэлектрика': [
                'Датчик ABS',
                'Датчик давления масла',
                'Датчик кислородный',
                'Датчик положения коленвала',
                'Датчик положения распредвала',
                'Датчик расхода воздуха',
                'Датчик температурный',
                'Датчик топливного фильтра',
                'Диодный мост',
                'Катушка зажигания',
                'Наконечник катушки зажигания',
                'Подогреватель топливного фильтра',
                'Предпусковой подогреватель двигатля',
                'Регулятор напряжения генератора',
                'Реле генератора',
                'Свеча зажигания',
                'Свеча накала',
                'Шлейф подрулевой',
            ],
            'Двигатель и выхлопная система': [
                'Бендикс',
                'Болт ГБЦ',
                'Вискомуфта',
                'Вкладыш коренной',
                'Вкладыш шатунный',
                'Вставка масляная',
                'Втягивающее реле',
                'Высоковольтные провода',
                'ГБЦ в сборе',
                'ГБЦ пустая',
                'Генератор',
                'Гильзы',
                'Клапан VVTi',
                'Клапан впускной',
                'Клапан выпускной',
                'Клапан холостого хода',
                'Коленвал',
                'Кольца поршневые',
                'Кольца глушителя',
                'Кронштейн вискомуфты',
                'Крышка радиатора',
                'Крышка трамблёра',
                'Направляющая клапана',
                'Насос гидроусилителя',
                'Насос масляный',
                'насос низкого давления',
                'Насос ручной подкачки топлива',
                'Насос топливный',
                'Натяжитель',
                'Опора двигателя',
                'Опопра кузова',
                'Плунжер ТНВД',
                'Плунжерная пара',
                'Подшипник генератора',
                'Подшипник компрессора кондиционера',
                'Подшипник натяжной',
                'Подшипник обводной',
                'Подшипник стартера',
                'Помпа водяная',
                'Поршни',
                'Прокладка ГБЦ',
                'Прокладка клапанной крышки',
                'Прокладка форсунки',
                'Радиатор',
                'Распредвал',
                'Распылитель форсунки',
                'Ремкомплект двигателя',
                'Ремкомплект ГРМ',
                'Ремкомплект ТНВД',
                'Ремкомплект турбины',
                'Ролик натяжной',
                'Стартер',
                'Термостат',
                'Трамблёр',
                'Трубка обратки',
                'Турбина',
                'Фильтр воздушный',
                'Фильтр масляный',
                'Фильтр салонный',
                'Фильтр топливный',
                'Фильтр топливный погружной',
                'Форсунка топливная',
                'Шкив генератора',
                'Шкив коленвала',
                'Щёточный узел генератора',
                'Щёточный узел стартера',
            ],
            'Детали подвески': [
                'Амортизатор',
                'Линк стабилизатора',
                'Опора амортизатора',
                'Отбойник амортизатора',
                'Пневмоподушка',
                'Подшипник опорный',
                'Пружина подвески',
                'Пыльник амортизатора',
                'Пыльник шаровой опоры',
                'Подшипник рулевой рейки',
                'Пыльник рулевой рейки',
                'Рулевая рейка',
                'Рулевой наконечник',
                'Рулевой редуктор',
                'Рычаг подвески',
                'Сайлентблок',
                'Тяга подвески',
                'Тяга рулевая',
                'Шаровая опора',
            ],
            'Трансмиссия и тормозная система': [
                'Втулка бронзовая',
                'Главный тормозной цилиндр',
                'Гофра',
                'Диск сцепления',
                'Кардынный вал',
                'Колодки барабанные',
                'Колодки дисковые',
                'Корзина сцепления',
                'Крестовина',
                'Крышка электрического хаба',
                'Лок/Хаб',
                'Подшипник выжимной',
                'Подшипник игольчатый',
                'Подшипник КПП',
                'Подшипник подвесной',
                'Подшипник редукторный',
                'Подшипник ступичный',
                'Привод',
                'Пыльник привода',
                'Ремкомплект поворотного кулака',
                'Ступичный узел',
                'Суппорт тормозной',
                'Тормозной шланг',
                'Трос МКПП',
                'Трос спидометра',
                'Шрус внешний',
            ],
        }

        created_count = 0
        updated_count = 0

        for category_name, products in categories_structure.items():
            # Создаем или получаем основную категорию
            category, created = Category.objects.get_or_create(
                name=category_name,
                parent=None,
                defaults={
                    'is_active': True,
                    'order': len(categories_structure) - list(categories_structure.keys()).index(category_name),
                }
            )

            if created:
                created_count += 1
                self.stdout.write(
                    self.style.SUCCESS(f'✓ Создана категория: {category_name}')
                )
            else:
                updated_count += 1
                self.stdout.write(
                    self.style.WARNING(f'→ Категория уже существует: {category_name}')
                )

        self.stdout.write(
            self.style.SUCCESS(
                f'\nГотово! Создано категорий: {created_count}, уже существовало: {updated_count}'
            )
        )
        self.stdout.write(
            self.style.SUCCESS(
                f'Всего категорий: {created_count + updated_count}'
            )
        )
