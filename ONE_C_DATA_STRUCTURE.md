# Структура данных API интеграции 1С

## Визуальная схема для программиста 1С

---

## Структура запроса (JSON)

```
┌─────────────────────────────────────┐
│         Запрос (Request)            │
├─────────────────────────────────────┤
│ token: String (обязательно)         │
│ products: Array (обязательно)       │
│   └─► [Товар 1, Товар 2, ...]      │
└─────────────────────────────────────┘
```

---

## Структура товара (Product)

```
┌─────────────────────────────────────┐
│           Товар (Product)           │
├─────────────────────────────────────┤
│                                     │
│  ОБЯЗАТЕЛЬНЫЕ ПОЛЯ:                │
│  ┌───────────────────────────────┐ │
│  │ sku: String                   │ │
│  │ name: String                  │ │
│  │ price: Decimal                │ │
│  └───────────────────────────────┘ │
│                                     │
│  ОПЦИОНАЛЬНЫЕ ПОЛЯ:                 │
│  ┌───────────────────────────────┐ │
│  │ description: String           │ │
│  │ old_price: Decimal            │ │
│  │ stock: Integer                 │ │
│  │ category: String              │ │
│  │ characteristics: Array         │ │
│  │   └─► [Характеристика, ...]   │ │
│  │ is_active: Boolean            │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## Структура характеристики (Characteristic)

```
┌─────────────────────────────────────┐
│    Характеристика (Characteristic) │
├─────────────────────────────────────┤
│                                     │
│  name: String (обязательно)        │
│  value: String (обязательно)       │
│                                     │
└─────────────────────────────────────┘
```

---

## Полная структура данных

```
Request
│
├─► token: "строка-токена"
│
└─► products: [
      │
      ├─► Product 1 {
      │     ├─► sku: "ART001"
      │     ├─► name: "Товар 1"
      │     ├─► price: 1000.00
      │     ├─► description: "Описание"
      │     ├─► old_price: 1500.00
      │     ├─► stock: 10
      │     ├─► category: "Категория 1"
      │     ├─► is_active: true
      │     │
      │     └─► characteristics: [
      │           ├─► {
      │           │     name: "Цвет",
      │           │     value: "Красный"
      │           │   }
      │           │
      │           └─► {
      │                 name: "Материал",
      │                 value: "Металл"
      │               }
      │         ]
      │   }
      │
      └─► Product 2 {
            ├─► sku: "ART002"
            ├─► name: "Товар 2"
            └─► price: 2000.00
          }
    ]
```

---

## Типы данных

### String (Строка)
```
┌─────────────┐
│   String    │
├─────────────┤
│ "текст"     │
│ "123"       │
│ ""          │
└─────────────┘
```

### Decimal (Число с дробной частью)
```
┌─────────────┐
│   Decimal   │
├─────────────┤
│ 1000.00     │
│ 1000.50     │
│ 0.99        │
└─────────────┘
⚠️ Разделитель: точка (.)
❌ НЕ запятая (,)
```

### Integer (Целое число)
```
┌─────────────┐
│   Integer   │
├─────────────┤
│ 0           │
│ 10          │
│ 100         │
└─────────────┘
```

### Boolean (Логическое значение)
```
┌─────────────┐
│   Boolean   │
├─────────────┤
│ true        │
│ false       │
└─────────────┘
⚠️ Без кавычек
❌ НЕ "true" или "false"
```

### Array (Массив)
```
┌─────────────┐
│    Array    │
├─────────────┤
│ [           │
│   элемент1, │
│   элемент2, │
│   ...       │
│ ]           │
└─────────────┘
```

---

## Пример полной структуры

```json
{
  "token": "ваш-секретный-токен",
  "products": [
    {
      "sku": "ART001",
      "name": "Товар 1",
      "description": "Описание товара",
      "price": 1000.00,
      "old_price": 1500.00,
      "stock": 10,
      "category": "Категория 1",
      "is_active": true,
      "characteristics": [
        {
          "name": "Цвет",
          "value": "Красный"
        },
        {
          "name": "Материал",
          "value": "Металл"
        }
      ]
    }
  ]
}
```

---

## Структура ответа (Response)

```
┌─────────────────────────────────────┐
│        Ответ (Response)             │
├─────────────────────────────────────┤
│                                     │
│  status: String                     │
│    ├─► "success"                    │
│    ├─► "partial"                    │
│    └─► "error"                      │
│                                     │
│  processed: Integer                 │
│  created: Integer                   │
│  updated: Integer                   │
│                                     │
│  errors: Array                      │
│    └─► [                            │
│          "Ошибка 1",                │
│          "Ошибка 2",                │
│          ...                        │
│        ]                            │
│                                     │
└─────────────────────────────────────┘
```

---

## Маппинг полей (CSV)

Если используете CSV файл, используйте следующие названия колонок:

```
CSV Колонка          →  Поле в системе
─────────────────────────────────────
sku                  →  sku
артикул              →  sku
article              →  sku
─────────────────────────────────────
name                 →  name
название             →  name
наименование         →  name
─────────────────────────────────────
price                →  price
цена                 →  price
─────────────────────────────────────
old_price            →  old_price
старая_цена          →  old_price
─────────────────────────────────────
stock                →  stock
остаток              →  stock
количество           →  stock
─────────────────────────────────────
category             →  category
категория            →  category
─────────────────────────────────────
is_active            →  is_active
активен              →  is_active
─────────────────────────────────────
[любая другая]       →  характеристика
```

---

## Маппинг полей (XML)

Если используете XML файл, используйте следующие теги:

```xml
<product> или <товар>
  <sku> или <артикул> или <article>
  <name> или <название> или <наименование>
  <price> или <цена>
  <old_price> или <старая_цена>
  <stock> или <остаток> или <количество>
  <category> или <категория>
  <is_active> или <активен>
  
  <characteristics> или <характеристики>
    <characteristic> или <характеристика>
      <name> или <название>
      <value> или <значение>
    </characteristic>
  </characteristics>
</product>
```

---

## Валидация данных

### Правила для цен

```
price
├─► Должна быть >= 0
├─► Тип: Decimal
└─► Разделитель: точка (.)

old_price (если указана)
├─► Должна быть >= 0
├─► Должна быть > price
├─► Тип: Decimal
└─► Разделитель: точка (.)
```

### Правила для остатков

```
stock
├─► Должен быть >= 0
├─► Тип: Integer
└─► По умолчанию: 0
```

### Правила для характеристик

```
characteristics
├─► Должен быть массивом
├─► Каждый элемент:
│   ├─► name: String (обязательно)
│   └─► value: String (обязательно)
└─► При обновлении: старые удаляются, новые создаются
```

---

## Логика обработки

```
Запрос
  │
  ├─► Проверка токена
  │   └─► Если неверный → 401
  │
  ├─► Валидация структуры
  │   └─► Если ошибка → 400
  │
  └─► Обработка каждого товара
      │
      ├─► Поиск по sku (артикул)
      │   ├─► Найден → Обновить
      │   └─► Не найден → Создать
      │
      ├─► Обновление полей
      │
      ├─► Обработка категории
      │   └─► Создать, если не существует
      │
      ├─► Обработка характеристик
      │   ├─► Удалить старые
      │   └─► Создать новые
      │
      └─► Обновление наличия
          ├─► stock > 0 → "В наличии"
          └─► stock = 0 → "Нет в наличии"
```

---

## Ограничения

```
┌─────────────────────────────────────┐
│         Ограничения                 │
├─────────────────────────────────────┤
│                                     │
│  sku:           100 символов       │
│  name:          500 символов       │
│  category:      200 символов       │
│  char.name:     200 символов       │
│  char.value:    500 символов       │
│                                     │
│  Рекомендуется:                    │
│  - До 100-200 товаров за запрос    │
│  - При больших объемах разбивать   │
│                                     │
└─────────────────────────────────────┘
```

---

## HTTP коды ответов

```
200 OK
├─► status: "success"
├─► errors: []
└─► Все товары обработаны

207 Multi-Status
├─► status: "partial"
├─► errors: ["Ошибка 1", ...]
└─► Часть товаров обработана

400 Bad Request
├─► status: "error"
└─► Ошибка валидации данных

401 Unauthorized
├─► status: "error"
└─► Неверный токен

500 Internal Server Error
├─► status: "error"
└─► Внутренняя ошибка сервера
```

---

## Контрольный список

```
□ Токен указан и корректен
□ products - массив с элементами
□ В каждом товаре:
  □ sku (обязательно)
  □ name (обязательно)
  □ price (обязательно)
  □ price >= 0
  □ Если old_price указана:
    □ old_price >= 0
    □ old_price > price
  □ stock >= 0 (если указан)
  □ Характеристики имеют name и value
□ Кодировка: UTF-8
□ Content-Type: application/json
```
