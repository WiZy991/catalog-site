{% extends 'base.html' %}
{% load static %}

{% block title %}Контакты - {{ SITE_NAME }}{% endblock %}
{% block meta_description %}Контакты {{ SITE_NAME }}. Телефон, адрес, email.{% endblock %}

{% block breadcrumbs %}
<nav class="breadcrumbs" aria-label="Хлебные крошки">
    <div class="container">
        <ol class="breadcrumbs__list" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumbs__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <a href="{% url 'core:home' %}" itemprop="item"><span itemprop="name">Главная</span></a>
                <meta itemprop="position" content="1">
            </li>
            <li class="breadcrumbs__item breadcrumbs__item--active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <span itemprop="name">Контакты</span>
                <meta itemprop="position" content="2">
            </li>
        </ol>
    </div>
</nav>
{% endblock %}

{% block extra_schema %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "{{ SITE_NAME }}",
    "telephone": "{{ SITE_PHONE }}",
    "email": "{{ SITE_EMAIL }}",
    "address": {
        "@type": "PostalAddress",
        "streetAddress": "{{ SITE_ADDRESS }}"
    }
}
</script>
{% endblock %}

{% block content %}
<section class="page-section">
    <div class="container">
        <h1 class="page-title">{% if page %}{{ page.title }}{% else %}Контакты{% endif %}</h1>
        
        {% if page and page.content %}
        <div class="page-content">
            {{ page.content|safe }}
        </div>
        {% endif %}
        
        <div class="contacts-grid">
            <div class="contacts-info">
                <div class="contact-block">
                    <div class="contact-block__icon">
                        <i class="bi bi-telephone-fill"></i>
                    </div>
                    <div class="contact-block__content">
                        <h3>Телефон</h3>
                        <a href="tel:{{ SITE_PHONE }}">{{ SITE_PHONE }}</a>
                        {% if SITE_PHONE_2 %}
                        <br><a href="tel:{{ SITE_PHONE_2 }}">{{ SITE_PHONE_2 }}</a>
                        {% endif %}
                    </div>
                </div>
                
                <div class="contact-block">
                    <div class="contact-block__icon">
                        <i class="bi bi-envelope-fill"></i>
                    </div>
                    <div class="contact-block__content">
                        <h3>Email</h3>
                        <a href="#" class="email-link" data-email="{{ SITE_EMAIL }}">{{ SITE_EMAIL }}</a>
                    </div>
                </div>
                
                <div class="contact-block">
                    <div class="contact-block__icon">
                        <i class="bi bi-chat-dots-fill"></i>
                    </div>
                    <div class="contact-block__content">
                        <h3>Мессенджеры</h3>
                        <div class="messengers-list">
                            {% if WHATSAPP_URL %}
                            <a href="{{ WHATSAPP_URL }}" target="_blank" rel="noopener noreferrer" class="messenger-link messenger-link--whatsapp">
                                <img src="{% static 'images/WhatsApp.svg.webp' %}" alt="WhatsApp" class="messenger-link__icon">
                                <span>Мы в WhatsApp</span>
                            </a>
                            {% endif %}
                            {% if TELEGRAM_URL %}
                            <a href="{{ TELEGRAM_URL }}" target="_blank" rel="noopener noreferrer" class="messenger-link messenger-link--telegram">
                                <img src="{% static 'images/Telegram_2019_Logo.svg.webp' %}" alt="Telegram" class="messenger-link__icon">
                                <span>Связаться через Telegram</span>
                            </a>
                            {% endif %}
                            {% if MAX_URL %}
                            <a href="{{ MAX_URL }}" target="_blank" rel="noopener noreferrer" class="messenger-link messenger-link--max">
                                <img src="{% static 'images/Max_logo_2025.png' %}" alt="MAX" class="messenger-link__icon">
                                <span>Связаться через MAX</span>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="contact-block">
                    <div class="contact-block__icon">
                        <i class="bi bi-geo-alt-fill"></i>
                    </div>
                    <div class="contact-block__content">
                        <h3>Адрес</h3>
                        <p>{{ SITE_ADDRESS }}</p>
                    </div>
                </div>
                
                <div class="contact-block">
                    <div class="contact-block__icon">
                        <i class="bi bi-clock-fill"></i>
                    </div>
                    <div class="contact-block__content">
                        <h3>Режим работы</h3>
                        <p>{{ SITE_HOURS|default:"Пн-Пт: 9:00 - 18:00" }}</p>
                    </div>
                </div>
                
                {% if FARPOST_PROFILE_URL %}
                <div class="contact-block">
                    <div class="contact-block__icon">
                        <i class="bi bi-shop"></i>
                    </div>
                    <div class="contact-block__content">
                        <h3>Наш магазин на Farpost</h3>
                        <a href="{{ FARPOST_PROFILE_URL }}" target="_blank" rel="noopener noreferrer">
                            Перейти в магазин на Farpost
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <div class="contacts-map">
                <div id="map"></div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
<script>
(function() {
    var mapInitialized = false;
    
    ymaps.ready(function () {
        if (mapInitialized) return;
        mapInitialized = true;
        
        var mapContainer = document.getElementById('map');
        if (!mapContainer) return;
        
        // SVG иконка маркера (base64)
        var markerSvg = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDMyIDQwIj48cGF0aCBkPSJNMTYgMEM3LjIgMCAwIDcuMiAwIDE2YzAgMTIgMTYgMjQgMTYgMjRzMTYtMTIgMTYtMjRDMzIgNy4yIDI0LjggMCAxNiAweiIgZmlsbD0iI2U1MzkzNSIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iMTQiIHI9IjYiIGZpbGw9IndoaXRlIi8+PC9zdmc+';
        
        var map = new ymaps.Map("map", {
            center: [43.82518, 131.95084],
            zoom: 16,
            controls: ['zoomControl']
        });
        
        // Создаём метку БЕЗ балуна
        var placemark = new ymaps.Placemark([43.82518, 131.95084], {
            hintContent: '{{ COMPANY_NAME|default:SITE_NAME }} - {{ SITE_ADDRESS }}'
        }, {
            iconLayout: 'default#image',
            iconImageHref: markerSvg,
            iconImageSize: [32, 40],
            iconImageOffset: [-16, -40],
            hasBalloon: false
        });
        
        map.geoObjects.add(placemark);
        
        // При клике открываем Яндекс.Карты с маршрутом
        placemark.events.add('click', function () {
            window.open('https://yandex.ru/maps/?pt=131.95084,43.82518&z=16&l=map', '_blank');
        });
    });
})();
</script>
{% endblock %}

