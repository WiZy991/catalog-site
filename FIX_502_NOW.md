# СРОЧНО: Исправление 502 Bad Gateway

## Проблема
Ошибка 502 Bad Gateway означает, что Django приложение не может запуститься. Скорее всего, это из-за синтаксической ошибки в `catalog/services.py`.

## Решение (выполните ПРЯМО СЕЙЧАС):

### Шаг 1: Загрузите исправленный файл на сервер

**Через файловый менеджер Beget:**
1. Откройте файл `catalog/services.py` на сервере
2. Убедитесь, что строки 371-375 выглядят так:

```python
        # Если не нашли TOYO-стиль, ищем стандартный формат: бренд + число (6 цифр)
        if not result['article']:
            article_match = re.search(rf'\b{brand_escaped}[,\s]+(\d{{6}})\b', name, re.IGNORECASE)
            if article_match:
                result['article'] = article_match.group(1)

    # Если не нашли через бренд, ищем TOYO-стиль артикул (TT-124, TU-1210) сразу после запятой
```

**ВАЖНО:** Строка 375 должна быть **полностью пустой** (без пробелов и табов)!

3. Также проверьте строку 663 - она должна быть так:

```python
                else:
                    category = get_category_for_product(name)
```

### Шаг 2: Перезапустите приложение

**Способ 1: Через файловый менеджер Beget**
1. Создайте папку `tmp` в корне проекта (если её нет)
2. Создайте или обновите файл `tmp/restart.txt` (можно просто добавить туда текущую дату/время)
3. Сохраните файл

**Способ 2: Через панель управления Beget**
1. Войдите в панель управления Beget
2. Перейдите в "Сайты" → выберите ваш сайт
3. Найдите кнопку "Перезапустить приложение" или "Restart"
4. Нажмите её

**Способ 3: Через SSH (если есть доступ)**
```bash
cd ~/onesimus/onesimus

# Проверьте синтаксис файла
python -m py_compile catalog/services.py

# Если ошибок нет, перезапустите
mkdir -p tmp
touch tmp/restart.txt

# Подождите 10-30 секунд
```

### Шаг 3: Проверьте результат

1. Подождите 10-30 секунд после перезапуска
2. Обновите страницу сайта (Ctrl+Shift+R для очистки кеша)
3. Если ошибка 502 исчезла - проблема решена!

## Если ошибка 502 всё ещё есть:

### Проверьте логи приложения

**Через панель управления Beget:**
1. Найдите раздел "Логи" или "Error logs"
2. Посмотрите последние ошибки
3. Ищите строки с "IndentationError", "SyntaxError" или "ImportError"

**Через SSH:**
```bash
cd ~/onesimus/onesimus

# Проверьте логи Django (если есть)
tail -n 50 logs/*.log

# Или проверьте логи веб-сервера
tail -n 50 /var/log/nginx/error.log
# или
tail -n 50 /var/log/apache2/error.log
```

### Проверьте синтаксис всех Python файлов

```bash
cd ~/onesimus/onesimus
source venv/bin/activate  # если используется виртуальное окружение

# Проверьте services.py
python -m py_compile catalog/services.py

# Если есть ошибки, они будут показаны
```

## Дополнительная информация:

- **Ошибка `safari is not defined`** в консоли браузера - это проблема расширения браузера (gosuslugi.plugin), **НЕ связана с вашим сайтом**. Её можно игнорировать.

- **Ошибка 502 Bad Gateway** означает, что веб-сервер (nginx/apache) не может связаться с Django приложением. Обычно это происходит из-за:
  - Синтаксических ошибок в Python коде
  - Приложение не запущено
  - Ошибки при импорте модулей
  - Проблемы с виртуальным окружением

## Быстрая проверка синтаксиса:

Если у вас есть доступ к файловому менеджеру Beget, вы можете проверить синтаксис через терминал в панели управления:

```bash
cd ~/onesimus/onesimus
python -m py_compile catalog/services.py
```

Если команда выполнилась без ошибок - синтаксис правильный. Если есть ошибки - они будут показаны.
